@model IEnumerable<Hospital_Management.Models.Entities.PatientsModel>

@{
    Layout = "_Layout2";
}

@{
    ViewData["Title"] = "Patients List";
}

<h2 class="text-center my-3">Patients List</h2>

<table class="table table-bordered table-striped table-hover" id="Patients">
    <thead class="table-dark">
        <tr>
            <th>Id</th>
            <th>Name</th>
            <th>Age</th>
            <th>Phone</th>
            <th>Email</th>
            <th>Gender</th>
            <th>Address</th>
            <th>Disease</th>
            <th>Disease History</th>
            <th>Created Date</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @if (Model != null && Model.Any())
        {
            foreach (var patient in Model)
            {
                <tr id="patient-@patient.Id">
                    <td>@patient.Id</td>
                    <td>@patient.Name</td>
                    <td>@patient.Age</td>
                    <td>@patient.PhoneNumber</td>
                    <td>@patient.Email</td>
                    <td>@patient.Gender</td>
                    <td>@patient.Address</td>
                    <td>@patient.Disease</td>
                    <td>@patient.DiseaseHistory</td>
                    <td>@patient.Createdate.ToString("dd-MMM-yyyy")</td>
                    <td class="m-2 d-flex gap-2">
                        <a asp-action="PatientsViewById" asp-route-id="@patient.Id" class="btn btn-info btn-sm">View</a>
                        <a asp-action="Edit" asp-route-id="@patient.Id" class="btn btn-warning btn-sm">Edit</a>

                        <!-- Delete Button -->
                        <button type="button" class="btn btn-danger btn-sm delete-btn" data-id="@patient.Id">Delete</button>
                    </td>
                </tr>
            }
        }
        else
        {
            <tr>
                <td colspan="11" class="text-center">No patients found.</td>
            </tr>
        }
    </tbody>
</table>

<a asp-asp-controller="Recap" asp-action="RegisterPatient" class="btn btn-primary">Add New Patient</a>

@section script {
    <script>
        $(document).ready(function() {
            // Delete Button Click Event
            $('.delete-btn').click(function(event) {
                var patientId = $(this).data('id'); // Get patient ID from the button's data-id attribute

                console.log('Patient ID:', patientId);  // Debugging: Check the patient ID in the console.

                // Show the confirmation dialog
                if (confirm('Are you sure you want to delete this patient?')) {
                    // Proceed with the Ajax request
                    $.ajax({
                        url: '@Url.Action("Delete", "Recap")',  // URL to your Delete action
                        type: 'POST',
                        data: { id: patientId },  // Send the patient ID in the data
                        success: function(response) {
                            // Debugging: Check the response from the server
                            console.log('Response:', response);

                            if (response.success) {
                                // Remove the deleted patient from the table UI
                                $('#patient-' + patientId).remove(); // Remove the row from the table

                                alert('Patient deleted successfully!');
                            } else {
                                alert('Error: ' + response.message);
                            }
                        },
                        error: function(xhr, status, error) {
                            alert('Error deleting patient. Please try again later.');
                        }
                    });
                }
            });
        });
    </script>
}
